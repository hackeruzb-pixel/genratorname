<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Random Ism Generator ‚Äî Firebase Auth Admin</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
* { box-sizing:border-box; margin:0; padding:0; }

body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg,#e0e7ff,#fef9ff);
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding:30px 10px;
  color:#333;
}

.box {
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(15px);
  border-radius: 25px;
  padding: 25px;
  width: 100%;
  max-width: 400px;
  margin-bottom: 25px;
  box-shadow: 0 20px 35px rgba(0,0,0,0.08);
  transition: all 0.4s ease;
  position: relative;
}
.box:hover { transform: translateY(-8px) scale(1.02); }

h2 {
  margin-bottom: 20px;
  font-size: 22px;
  font-weight: 700;
  text-align: center;
  color:#4f46e5;
}

input {
  width: 100%;
  padding: 14px 16px;
  border-radius: 15px;
  border:1px solid #ddd;
  outline:none;
  margin-bottom: 12px;
  background: #fdfdfd;
  color:#333;
  font-size: 16px;
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.05);
  transition: all 0.2s ease;
}
input:focus { border-color:#7c3aed; box-shadow: inset 0 2px 6px rgba(124,58,237,0.18); }

button {
  width: 100%;
  padding: 14px;
  border-radius: 15px;
  border:none;
  cursor:pointer;
  font-weight: 600;
  font-size: 16px;
  transition: all 0.25s ease;
  background: linear-gradient(90deg,#7c3aed,#3b82f6);
  color:#fff;
  box-shadow: 0 6px 15px rgba(124,58,237,0.25);
}
button:hover { transform: translateY(-3px) scale(1.02); }

.btn-danger { background:#ff4b5c; color:#fff; width:auto; padding:6px 12px; font-size:14px; border-radius:10px; }
ul { list-style:none; margin-top:15px; max-height:220px; overflow-y:auto; padding-right:5px; }
li { background: #f5f5f5; margin-bottom: 8px; padding:12px; border-radius:15px; display:flex; justify-content:space-between; align-items:center; font-weight:500; }

#randomName {
  font-size:32px;
  font-weight:800;
  color:#7c3aed;
  margin-top:20px;
  text-align:center;
  min-height:50px;
  transition: all 0.2s ease;
  letter-spacing: 1px;
}

#miniAdminBtn {
  display:block;
  margin:12px 0 0 auto;
  background: linear-gradient(135deg,#7c3aed,#3b82f6);
  color:#fff;
  padding:10px 16px;
  border:none;
  border-radius:50px;
  font-size:14px;
  font-weight:600;
  cursor:pointer;
  transition: all 0.25s ease;
}
#miniAdminBtn:hover { transform: scale(1.12); }

#logoutBtn {
  position: absolute;
  top: 14px;
  left: 14px;
  background: transparent;
  color: #7c3aed;
  border: 1px solid #e9d5ff;
  padding: 8px 10px;
  border-radius: 12px;
  font-weight:700;
  cursor:pointer;
}

.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 60;
}
.modal {
  width: 92%;
  max-width: 380px;
  background: linear-gradient(180deg, #fff, #fbfbff);
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.25);
  transform: translateY(-10px);
  transition: all 0.25s ease;
}
.modal h3 { margin-bottom:12px; color:#4338ca; font-size:18px; text-align:center; }
.modal.show { display:flex; }
.shake { animation: shake 550ms ease; }
@keyframes shake {
  0% { transform: translateX(0); }
  20% { transform: translateX(-8px); }
  40% { transform: translateX(8px); }
  60% { transform: translateX(-6px); }
  80% { transform: translateX(6px); }
  100% { transform: translateX(0); }
}

@media(max-width:400px){
  .box { padding:18px; }
  h2 { font-size:20px; }
  #randomName { font-size:26px; }
}
</style>
</head>
<body>

<!-- Admin Box -->
<div class="box" id="adminBox">
  <h2>üîê Admin Panel</h2>
  <div id="adminContent" style="display:none">
    <input id="nameInput" type="text" placeholder="Ism kiriting...">
    <button onclick="addName()">Ism qo‚Äòshish</button>
    <ul id="nameList"></ul>
    <button onclick="finishAdmin()" style="margin-top:12px;">‚úÖ Tayyor</button>
  </div>
  <button id="miniAdminBtn" onclick="openAdmin()">üîß Admin</button>
</div>

<!-- Random Box -->
<div class="box">
  <h2>üé≤ Random Ism</h2>
  <button onclick="getRandom()">Random</button>
  <div id="randomName">‚Äî</div>
</div>

<!-- Admin Login Modal -->
<div id="pwdModal" class="modal-backdrop" aria-hidden="true">
  <div id="pwdCard" class="modal" role="dialog" aria-modal="true" aria-labelledby="pwdTitle">
    <h3 id="pwdTitle">Admin kirish</h3>
    <input id="pwdEmail" type="email" placeholder="Email">
    <input id="pwdInput" type="password" placeholder="Parol">
    <div style="display:flex; gap:10px; margin-top:10px;">
      <button id="pwdSubmit" style="flex:1">Kirish</button>
      <button id="pwdCancel" style="flex:1; background:#f3f4f6; color:#111; box-shadow:none;" onclick="closePwdModal()">Bekor</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";

/* Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyDBa5S-QkwCNeeVK4aatEl5G3tUTbLZgAk",
  authDomain: "generator-5f0ab.firebaseapp.com",
  databaseURL: "https://generator-5f0ab-default-rtdb.firebaseio.com",
  projectId: "generator-5f0ab",
  storageBucket: "generator-5f0ab.appspot.com",
  messagingSenderId: "1001983949799",
  appId: "1:100198394979f5db42"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

/* Elements */
const nameInput = document.getElementById("nameInput");
const nameList = document.getElementById("nameList");
const randomName = document.getElementById("randomName");
const miniAdminBtn = document.getElementById("miniAdminBtn");
const adminContent = document.getElementById("adminContent");
const logoutBtn = document.getElementById("logoutBtn");

const pwdModal = document.getElementById("pwdModal");
const pwdCard = document.getElementById("pwdCard");
const pwdEmail = document.getElementById("pwdEmail");
const pwdInput = document.getElementById("pwdInput");
const pwdSubmit = document.getElementById("pwdSubmit");

/* ---------- Firebase DB ---------- */
let names = [];
let lastRandom = null;
const namesRef = ref(db, "names");
onValue(namesRef, snapshot=>{
  names = [];
  nameList.innerHTML = "";
  let i=1;
  snapshot.forEach(child=>{
    const key=child.key;
    const val=child.val();
    names.push(val);
    const li=document.createElement("li");
    li.innerHTML=`${i}. ${val} <button class='btn-danger' onclick="deleteName('${key}')">‚ùå</button>`;
    nameList.appendChild(li);
    i++;
  });
});

/* Admin DB functions */
window.addName = function(){
  const val = nameInput.value.trim();
  if(!val) return alert("Ism kiriting!");
  if(names.includes(val)) return alert("Bu ism bor!");
  push(namesRef, val);
  nameInput.value = "";
}
window.deleteName = function(key){ remove(ref(db, "names/" + key)); }

/* ---------- Random Name ---------- */
window.getRandom = function(){
  if(names.length===0){ randomName.textContent="Ismlar yo‚Äòq!"; return; }
  let finalName;
  if(names.length===1){ finalName=names[0]; }
  else{
    do{ finalName=names[Math.floor(Math.random()*names.length)]; }while(finalName===lastRandom);
  }
  lastRandom=finalName;
  animateFlash(finalName);
}
function animateFlash(finalName){
  let count=0;
  const flashCycles=20;
  const interval=setInterval(()=>{
    randomName.textContent = names[Math.floor(Math.random()*names.length)];
    randomName.style.color="#" + Math.floor(Math.random()*16777215).toString(16);
    randomName.style.transform=`scale(${1+Math.random()*0.25}) rotate(${Math.random()*10-5}deg)`;
    count++;
    if(count>=flashCycles){
      clearInterval(interval);
      randomName.textContent = finalName;
      randomName.style.color="#7c3aed";
      randomName.style.transform="scale(1.4)";
      setTimeout(()=>{ randomName.style.transform="scale(1)"; },800);
    }
  },70);
}

/* ---------- Admin Auth ---------- */
window.openAdmin = function(){
  pwdInput.value = "";
  pwdEmail.value = "";
  pwdModal.classList.add("show");
  pwdModal.style.display = "flex";
  pwdCard.classList.remove("shake");
  pwdEmail.focus();
}
function closePwdModal(){ pwdModal.classList.remove("show"); pwdModal.style.display="none"; }

pwdSubmit.addEventListener("click", loginAdmin);
pwdInput.addEventListener("keydown", e=>{ if(e.key==="Enter") loginAdmin(); });
pwdEmail.addEventListener("keydown", e=>{ if(e.key==="Enter") loginAdmin(); });

function loginAdmin(){
  const email = pwdEmail.value.trim();
  const password = pwdInput.value.trim();
  if(!email||!password) return alert("Email va parol kiriting!");
  signInWithEmailAndPassword(auth,email,password)
    .then(userCredential=>{
      closePwdModal();
      adminContent.style.display="block";
      miniAdminBtn.style.display="none";
      logoutBtn.style.display="inline-block";
    })
    .catch(err=>{
      pwdCard.classList.remove("shake");
      void pwdCard.offsetWidth;
      pwdCard.classList.add("shake");
      pwdInput.value="";
      pwdEmail.focus();
    });
}

window.logoutAdmin=function(){
  signOut(auth).then(()=>{
    adminContent.style.display="none";
    miniAdminBtn.style.display="block";
    logoutBtn.style.display="none";
  });
}

window.finishAdmin=function(){
  adminContent.style.display="none";
  miniAdminBtn.style.display="block";
  logoutBtn.style.display="none";
}

/* click outside modal to close */
pwdModal.addEventListener("click",(e)=>{ if(e.target===pwdModal) closePwdModal(); });
</script>
</body>
</html>
